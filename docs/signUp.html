<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="stylesheet" href="./css1/signUp.css">
</head>

<body>
    <form>
        <label for="userIdInput">User Id</label>
        <input type="text" id="userIdInput">
        <label for="userProfileInput">Upload Profile Photo</label>
        <input type="file" id="userProfileInput">
        <label for="passwordInput">Password</label>
        <input type="text" id="passwordInput">
        <button type="button" id="signUpBtn">Sign Up</button>
    </form>
    <script>
        const API_BASE = '';//'https://abc-978804600164.asia-south1.run.app';//'https://sorted-backend-978804600164.asia-south1.run.app/'; //'https://sorted18deploy-production.up.railway.app';//sorted18deploy-production.up.railway.app';

        const signUpBtn = document.getElementById('signUpBtn');
        signUpBtn.addEventListener('click', async () => {
            let userIdInput = document.getElementById('userIdInput').value;
            let passwordInput = document.getElementById('passwordInput').value;
            let userProfileInput = document.getElementById('userProfileInput').files[0];
            console.log(userProfileInput.type);
            let tempForm = new FormData();
            tempForm.append('image', userProfileInput);
            tempForm.append('userId', userIdInput);
            tempForm.append('password', passwordInput);
            // const faceId = await (await fetch('/getNewFaceId', {
            //     method: 'POST',
            //     body: tempForm
            // })).json();
            // let faceEmbeddingsObj = (await fetch(`${API_BASE}/face-embed`, {
            //     method: 'POST',
            //     body: tempForm,
            //     credentials: 'include'
            // }));

            // let faceEmbeddingsJson= await faceEmbeddingsObj.json();

            const res = await fetch(`${API_BASE}/face-embed`, {
                method: 'POST',
                body: tempForm,
                credentials: 'include'
            });
            if (!res.ok) {
                const txt = await res.text();
                alert("Face service unavailable. Try again.");
                throw new Error(txt);
            }
            const faceEmbeddingsJson = await res.json();
            tempForm.append('faceEmbeddings', JSON.stringify(faceEmbeddingsJson.embedding));

            //tempForm.append('faceEmbeddings', faceEmbeddings);
            await fetch(`${API_BASE}/signUp`, {
                method: 'POST',
                body: tempForm,
                credentials: 'include'
            });
            window.location.href = '/index.html';//'https://gagan1606.github.io/sorted_1.8_deploy/index.html';
        })
    </script>
</body>

</html>